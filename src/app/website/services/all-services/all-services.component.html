<div class="web auto-flex-start-gap40-column main-div">

    <div class="auto-flex-center-space-between-gap20 light-gray-bg border-none border-radius-0 padding-left-right-30">

        <!-- Current Location-->
        <div class="auto-flex-center-start-gap20-no-set-width cursor-pointer desktop" (click)="showCurrentLocation()">

            <img class="smallImg" src="assets/images/web/icons/location.svg" />

            <div class="auto-flex-start-gap5-column-no-set-width width-max-500">

                <p class="med bold">Current location</p>
                <p class="web-font-primary-light width-300">{{ locationName }}</p>

            </div>

        </div>

        <a class="cursor-pointer" (click)="navigate('/')">
            <img class="xxmedImg" src="assets/images/web/logo.svg" />
        </a>

        <div class="auto-flex-center-gap20-no-set-width desktop">

            <a class="xsmall web-font-primary bold cursor-pointer" (click)="navigate('/')">Home</a>
            <a class="xsmall web-font-primary bold" href="https://www.taibsa.com/blog">Blog</a>
            <a class="xsmall web-font-primary bold" href="https://www.taibsa.com/medical-calculator">Calculator</a>
            <a class="xsmall web-font-primary bold" href="https://www.taibsa.com/contact">Contact</a>
 
            <div class="auto-flex-center-gap5-no-set-width cursor-pointer">

                <a class="xsmall web-font-primary bold" (click)="navigate('/checkout/cart')"><img class="img-20" src="assets/images/web/icons/cart.svg" /></a>
                <div class="auto-flex-center-gap10 border-radius-100 red-bg border-none height-16 width-16 text-center padding-15"  *ngIf="cartData && cartData.length>0">

                    <a class="xsmall secondary-color"  (click)="navigate('/checkout/cart')">{{ cartLength }}</a>
    
                </div>
 
            </div>

            
            <a class="xsmall lightest-blue-bg cursor-pointer padding-10 border-none" (click)="navigateToLogin()" *ngIf="userId === null">Patient login</a>
            <a class="xsmall lightest-blue-bg cursor-pointer padding-10 border-none" (click)="navigateToLogin()" *ngIf="userId !== null"><img class="img-20" src="assets/images/web/icons/account_login.svg" /></a>
         
        </div>

        <div class="mobile auto-flex-center-gap10-no-set-width padding-10 white-bg">

            <a class="xsmall web-font-primary bold" (click)="openMenu()">
                <img class="xsmallImg" src="assets/images/web/icons/menu.svg" />
            </a>

        </div>

        <div class="light-gray-bg fixed mobile z-index menu-mobile mobile padding-none" id="menuBar" style="z-index: 10000;">

            <a class="xsmall web-font-primary bold absolute-top-right-30" (click)="closeMenu()"><img class="img-20" src="assets/images/web/icons/close.svg" /></a>

            <div class="auto-flex-start-gap20-column padding-20">

                <a class="xsmall web-font-primary bold" href="www.taibsa.com">Home</a>
                <a class="xsmall web-font-primary bold" (click)="navigate('/medical-services')">Services</a>
                <a class="xsmall web-font-primary bold" href="https://www.taibsa.com/blog">Blog</a>
                <a class="xsmall web-font-primary bold" href="https://www.taibsa.com/medical-calculator">Calculator</a>
                <a class="xsmall web-font-primary bold" href="https://www.taibsa.com/contact">Contact</a>

                <div class="auto-flex-center-gap5-no-set-width">

                    <a class="xsmall web-font-primary bold" (click)="navigate('/checkout/cart')"><img class="img-20" src="assets/images/web/icons/cart.svg" /></a>
                    <div class="auto-flex-center-gap10 border-radius-100 red-bg border-none height-16 width-16 text-center padding-15"  *ngIf="cartData && cartData.length>0">

                        <a class="xsmall secondary-color">{{ cartData.length }}</a>

                    </div>

                </div>

                
            <a class="xsmall lightest-blue-bg cursor-pointer padding-10 border-none" (click)="navigateToLogin()" *ngIf="userId === null">Patient login</a>
            <a class="xsmall lightest-blue-bg cursor-pointer padding-10 border-none" (click)="navigateToLogin()" *ngIf="userId !== null"><img class="img-20" src="assets/images/web/icons/account_login.svg" /></a>

            </div>

        </div>

    </div>

</div>

<div class="web auto-flex-start-gap40-column main-div-max padding-top-20 padding-20" style="padding: 20px;">

     <!-- Current Location-->
     <div class="auto-flex-center-start-gap20 mobile cursor-pointer" (click)="showCurrentLocation()">

        <img class="smallImg" src="assets/images/web/icons/location.svg" />

        <div class="auto-flex-start-gap5-column-no-set-width width-max-500">

            <p class="med bold">Current location</p>
            <p class="web-font-primary-light width-max-300">{{ locationName }}</p>

        </div>

    </div>

    <!-- Top Category -->
    <div class="auto-flex-center-space-between-gap20 place-stretch" *ngIf="allServices && allServices.length>0">

        <div class="auto-flex-center-space-between-gap20-no-set-width width-half lightest-blue-bg padding-20 cursor-pointer" [style.background-color]="category.bg_color" *ngFor="let category of topCategories; let topCategoryIndex = index">

            <div class="auto-flex-start-gap10-column-no-set-width width-max-300 phone-width-120" (click)="navigateToCategory(category.id)">

                <p class="med bold capitalize width-max-300"> {{ category.title }} </p>
                <p class="web-font-primary-light width-max-300 width-max-phone-130"> {{ category.description }} </p>

            </div>

            <div class="auto-flex-center-gap10-column-no-set-width white-bg padding-none phone-width-120 phone-width-100 border-none relative self-stretch width-160 max-height margin-top-20 margin-right-20 border-bottom-left-bottom-right-0 phone-max-height-150">

                <img class="xxxmedImg" src="{{serverUrl}}{{category.image}}" />

            </div>

        </div>
    
    </div>

    <!-- All Ctegories -->
    <div class="auto-flex-start-gap20-column light-gray-bg" *ngIf="allServices && allServices.length>0">

        <p class="xmed bold capitalize">Categories</p>
        
        <div class="auto-flex-start-gap20-no-wrap overflow-auto padding-bottom-20 place-stretch scroll-bar">

            <div class="auto-flex-center-gap10-column-no-set-width white-bg cursor-pointer border-radius-20 width-min-150 padding-10 item-hover" (click)="navigateToCategory(category.id)" *ngFor="let category of allCategories; let categoryIndex = index">

                <img class="medImg" src="{{serverUrl}}{{category.icon}}" />
                <p class="bold capitalize web-font-primary-light xsmall text-center">{{ category.title }}</p>

            </div>
        </div>

    </div>

    <!-- Services -->
    <div class="auto-flex-center-gap30-column" *ngIf="allServices && allServices.length>0">
        <div class="auto-flex-center-gap30-column" *ngFor="let item of displayedCategories">

            <div class="auto-flex-start-gap20-column" *ngIf="item.services.length>0">

                <p class="xmed bold capitalize">{{ item.category_data.title }}</p>
        
                <div class="auto-flex-start-center-gap20-no-wrap overflow-auto padding-bottom-20 place-stretch scroll-bar-gray">
        
                    <div class="auto-flex-space-between-gap20-column-no-set-width gray-border border-radius-20 cursor-pointer padding-none width-max-350 relative" (click)="navigateToService(service.id)" *ngFor="let service of item.services">
        
                        <p class="absolute-top-left-10 xsmall primary-bg padding-5 padding-left-right-10  border-none z-index">{{ service.price }} SAR</p>
                        
                        <div class="linear-gradient-blue absolute height-160 border-top-left-right-10"></div>
                        <img class="xxlargeImg-350 height-160 cover border-top-left-right-10" src="{{serverUrl}}{{service.cover_image}}">
        
                        <div class="auto-flex-start-gap10-column-no-set-width padding-left-right-10">
        
                            <p class="med bold capitalize">{{ service.title }}</p>
                            <p class="web-font-primary-light"> {{ service.description | slice:0:90 }}...  </p>
        
                        </div>
        
                        <div class="auto-flex-end-gap10">
        
                            <button class="primary-bg padding-10 capitalize box-shadow border-none border-top-left-bottom-left-0 border-top-right-0 padding-left-right-30 padding-top-bottom-5 xsmall">view more</button>
        
                        </div>
        
                    </div>
        
                    <div class="auto-flex-center-gap20-column-no-set-width cursor-pointer" (click)="showMore(item.category_data.url)">
        
                        <img class="smallImg" src="assets/images/web/icons/plus.svg" />
                        <p class="xsmall bold lowercase text-center">show more</p>
        
                    </div>
        
                </div>
            
            </div>
        
        </div>
    </div>

    <div class="auto-flex-center-gap20" *ngIf="allServices && allServices.length>0">

        <button class="primary-bg padding-10 capitalize box-shadow xsmall width-max-300 max-width" (click)="loadMoreCategories()" *ngIf="allCategories && displayedCategories.length<allCategories.length">Load More</button>

    </div>


    <!-- Location Modal -->
    <div class="auto-flex-center-gap10 fixed dialog" *ngIf="userCurrentLocation" style="z-index: 1000;">

        <div class="popup">

            <div class="auto-flex-center-gap30-column-no-set-width padding-40 white-bg overflow-auto max-height-500 border-radius-20 width-600 max-width relative phone-max-300">

                <a class="xsmall web-font-primary bold absolute-top-right-30 cursor-pointer" (click)="userCurrentLocation = !userCurrentLocation"><img class="img-20" src="assets/images/web/icons/close.svg" /></a>


                <div class="auto-flex-center-start-gap20">

                    <img class="xsmallImg" src="assets/images/web/icons/send.svg" />
                    <p class="bold">Use my current location</p>

                </div>

                <div class="auto-flex-start-gap20-column box-shadow padding-none border-radius-10 gray-border">
                    
                    <agm-map class="max-width height-200 border-top-left-right-10 overflow-hidden" [latitude]="centerLat" [longitude]="centerLng" [zoom]="zoom" [streetViewControl]="false" [zoomControl]="false" [mapTypeControl]="false">
                    
                    </agm-map>

                    <div class="auto-flex-center-space-between-gap20 padding-left-right-30 padding-bottom-20">

                        <div class="auto-flex-start-gap10 width-max-300">

                            <p class="bold">{{ cityName }}</p>
                            <p class="web-font-primary-light"> {{ locationName }} </p>
    
                        </div>
                        <!--openMap()-->
                        <img class="smallImg cursor-pointer" src="assets/images/web/icons/edit.svg" (click)="navigateToDashboard()" />

                    </div>
              
                </div>

                <div class="auto-flex-center-start-gap20 cursor-pointer" (click)="openMap()">

                    <img class="xsmallImg" src="assets/images/web/icons/plus_black.svg" />
                    <p class="xsmall bold lowercase text-center">Add new address</p>

                </div>

                <div class="auto-flex-start-gap10-no-wrap overflow-auto" *ngIf="userLocations.length>0">

                    <div class="auto-flex-start-gap10-column-no-set-width padding-bottom-20 scroll-bar-gray" *ngFor="let loc of userLocations; let locIndex = index;">

                        <div class="auto-flex-start-gap10-column-no-set-width white-bg box-shadow item-hover cursor-pointer width-200" (click)="setCurrentLocation(loc)">
    
                            <p class="xsmall bold">Name: {{ loc.address_name }}</p>
                            <p class="xsmall" *ngIf="loc.city.length>0">City: {{ loc.city }}</p>
                            <p class="xsmall" *ngIf="loc.address_line1.length>0">Address: {{ loc.address_line1 }} {{ loc.address_line2 }}</p>
    
                        </div>
    
                    </div>

                </div>
               
            </div>

        </div>

    </div>

    <!-- Location Modal Select -->
    <div class="auto-flex-center-gap10 fixed dialog" *ngIf="selectMapLocation" (click)="closeMap()">

        <div class="popup">

            <div class="auto-flex-center-gap30-column-no-set-width white-bg overflow-auto max-height-500 border-radius-20 width-600 relative padding-none border-none">

                <div class="auto-flex-center-gap20-column box-shadow padding-none border-radius-10 gray-border" (click)="$event.stopPropagation()">

                    <input #search class="input-global absolute-top-10 z-index width-90Percent" type="text" placeholder="Search" />

                    <agm-map class="max-width height-300 width-600 phone-300 border-top-left-right-10 overflow-hidden" [latitude]="centerLat" [longitude]="centerLng" [zoom]="zoom" [streetViewControl]="false" [zoomControl]="false" [mapTypeControl]="false" (mapClick)="onMapClick($event)" >
                
                        <agm-marker *ngIf="selectedLat && selectedLng" [latitude]="selectedLat"  [longitude]="selectedLng" [markerDraggable]="true" (dragEnd)="onMarkerDragEnd($event);"  class="border-radius-10"></agm-marker>
                    
                    </agm-map>

                    <button *ngIf="placeSelected" class="primary-bg padding-10 border-none box-shadow absolute-bottom-10 width-300 phone-width-150 z-index" (click)="onConfirmLocation()">Confirm</button>
                
                </div>

            </div>

        </div>

    </div>

    <!-- Add new address -->
    <div class="auto-flex-center-gap10 fixed dialog" *ngIf="addNewAddressToggle">

        <div class="popup">

            <div class="auto-flex-start-gap20-column white-bg overflow-auto max-height-500 border-radius-20 width-min-600 phone-min-width">
                
                <div class="auto-flex-start-no-gap-column">

                    <div class="auto-flex-center-space-between-gap20">

                        <p class="med bold capitalize">Add new address</p>
                        <img class="xsmallImg cursor-pointer" src="assets/images/web/icons/close.svg" (click)="discardAddress()" />
    
                    </div>
    
                    <hr class="hr-black" />    

                </div>

                <form class="auto-flex-start-gap10" [formGroup]="addressForm" (ngSubmit)="createAddress()">

                    <div class="auto-flex-start-gap10-column web-font-primary-light">
        
                        <p class="xsmall bold">Address Name</p>
                        <input class="input-global" type="text" formControlName="address_name" placeholder="Enter address name" />
                        <p *ngIf="addressForm.get('address_name').hasError('invalidAddressName')" class="xsmall red-color">Enter address name</p>

                    </div>    

                    <div class="auto-flex-start-gap10 web-font-primary-light">

                        <p class="xsmall bold">Address line 1</p>
                        <input class="input-global" type="text" formControlName="address_line1"  placeholder="Enter address" />
                        <p *ngIf="addressForm.get('address_line1').hasError('invalidAddressLine1')" class="xsmall red-color">Enter adress line</p>

                    </div>    
    
                    <div class="auto-flex-start-gap10 web-font-primary-light">
    
                        <p class="xsmall bold">Address line 2</p>
                        <input class="input-global" type="text" placeholder="Enter address (optional)" />
            
                    </div>    
    
                    <p *ngIf="addressForm.get('latitude').hasError('invalidLocation') || addressForm.get('longitude').hasError('invalidLocation')" class="xsmall red-color">Please select valid location</p>
                    
                    <div class="auto-flex-end-gap10">
        
                        <!-- continue button -->
                        <button class="primary-bg padding-10 box-shadow width-200 xsmall phone-width-auto" type="submit">Save changes</button>
    
                    </div>
                    
                </form>
            
            </div>

        </div>

    </div>

    <!-- An Error occured while updating user. Try again later -->
    <app-custom-alert *ngIf="showErrorUpdatingAddress" [title]="'Error'" [message]="'An error occured while saving address in your account but you can use this address to book service.'" [cancelButtonText]="'Cancel'" [continueButtonText]="'Continue'" (cancelClick)="handleCancelClick()" (continueClick)="handleContinueClick()" [showCancel]="false" [showConfirm]="true"></app-custom-alert>

    <div class="auto-flex-center-gap10 lightest-blue-bg" *ngIf="allServices && allServices.length<=0">

        <p class="bold">No services found. Please change your location.</p>

    </div>

</div>

<app-checkout-footer></app-checkout-footer>